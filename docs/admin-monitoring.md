## Admin Live Monitoring

Новая вкладка **Live Monitoring** доступна в админке (`/admin2admin10` и `/am/admin2admin10`).

### Что показывается

- **Active users (last 5 / 15 min)**  
  Число пользователей, у которых были запросы к защищённым эндпоинтам за последние 5 и 15 минут. Помогает оценить реальный «онлайн» в дашборде.

- **Requests / min и Total requests**  
  - `Requests/min` — сколько HTTP‑запросов прилетело к API за последнюю минуту.  
  - `Total since restart` — сколько запросов обработано с момента последнего рестарта Node/PM2.

- **Server load**  
  - `CPU load` — средняя системная нагрузка за 1 минуту (аналог `loadavg`).  
  - `Uptime` — сколько времени процесс Node работает без рестарта.

- **DB connections**  
  - `Active` — количество активных коннектов к PostgreSQL (из `pg_stat_activity`).  
  - `Total` — общее количество коннектов (включая idle).

- **Memory**  
  - `Total system RAM` — общий объём RAM сервера.  
  - `Free system RAM` — свободная RAM на уровне ОС.  
  - `Node RSS` — память, занятую процессом Node (вся, включая heap/стек/модули).  
  - `Node heap used` — используемая JS‑куча (то, что управляется GC).

### Как часто обновляется

- Вкладка **Live Monitoring** опрашивает endpoint `GET /api/admin/metrics` **раз в 5 секунд**, пока вкладка открыта.
- Эндпоинт защищён `requireAdminAuth`, доступны только админские JWT‑токены.
- Метрики по БД кэшируются на 5 секунд, чтобы частые обновления в админке не создавали лишнюю нагрузку на Postgres.

### Как интерпретировать

- Если `Active users (5 min)` стабильно растёт и приближается к **400–800** на текущем сервере — это сигнал задуматься об апгрейде или масштабировании.  
- Если `CPU load` большую часть времени **выше 4–5** на 6 vCPU, а ответы начинают замедляться — сервер близок к пределу.  
- Если `DB activeConnections` часто подбирается к **80–90** при `max_connections = 100`, стоит рассмотреть:
  - оптимизацию запросов,
  - увеличение ресурсов,
  - тонкую настройку пула соединений и Postgres.

Для долгосрочной истории можно поверх этого эндпоинта подключить внешний мониторинг (Prometheus/Grafana), но для быстрых проверок в реальном времени вкладки Live Monitoring достаточно.

