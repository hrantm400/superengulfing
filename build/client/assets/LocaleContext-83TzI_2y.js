import{j as u}from"./jsx-runtime-0DLF9kdB.js";import{r as a,a as h}from"./index-QScjhSTK.js";import{g as m,a as v}from"./api-c0T8i5BA.js";import{L as x}from"./components-CDq68o1-.js";const _=a.createContext(void 0);function k({children:e}){const[c,t]=a.useState(null),o=a.useCallback(async()=>{if(!m()){t(null);return}try{const r=await v("/api/me");if(r.status===401){localStorage.removeItem("auth_token"),t(null);return}if(!r.ok){t(null);return}const n=await r.json(),s=n.locale==="am"?"am":"en";t({id:n.id,email:n.email,first_name:n.first_name||"",onboarding_completed:n.onboarding_completed===!0,certificate_section_collapsed:n.certificate_section_collapsed===!0,tradingview_username:n.tradingview_username||"",indicator_access_status:n.indicator_access_status||"none",indicator_requested_at:n.indicator_requested_at??null,indicator_rejected_reason:n.indicator_rejected_reason??null,indicator_rejected_at:n.indicator_rejected_at??null,locale:s})}catch{t(null)}},[]);a.useEffect(()=>{m()?o():t(null)},[o]);const i={profile:c,setProfile:t,refetch:o};return u.jsx(_.Provider,{value:i,children:e})}function p(){const e=a.useContext(_);if(e===void 0)throw new Error("useUser must be used within UserProvider");return e}const f=a.createContext(void 0);function b({children:e}){const t=h().pathname,{profile:o}=p(),i=a.useMemo(()=>{const l=(o==null?void 0:o.locale)??(t.startsWith("/am")?"am":"en"),r=l==="am"?"/am":"";return{locale:l,basePath:r,localizePath:s=>{const d=s.startsWith("/")?s:`/${s}`;return r?`${r}${d}`:d}}},[t,o==null?void 0:o.locale]);return u.jsx(f.Provider,{value:i,children:e})}function L(){const e=a.useContext(f);if(e===void 0)throw new Error("useLocale must be used within LocaleProvider (inside Router)");return e}function C({to:e,...c}){const{localizePath:t}=L(),o=typeof e=="string"?t(e):e;return u.jsx(x,{to:o,...c})}export{C as L,k as U,p as a,b,L as u};
