import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{b as q,u as G,a as H,r as m}from"./index-QScjhSTK.js";import{u as K}from"./LocaleContext-83TzI_2y.js";import{u as Q}from"./index-CbJBlSim.js";import{b as R,a as w}from"./api-c0T8i5BA.js";import{c as W}from"./createLucideIcon-CnELezcF.js";import{B as X}from"./book-open-DpnmxrYp.js";import{C as v}from"./chevron-right-DgoQG_vz.js";import{L as T}from"./components-CDq68o1-.js";import{P as Y}from"./play-DVjtrMIX.js";import{C as ee,a as se,b as B}from"./circle-play-gq9cW0kN.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],F=W("chevron-left",te);function re(x,h){var f,c;if(!h||!x)return null;try{const s=new URL(h.trim()),p=s.hostname.toLowerCase();if(x==="youtube"){if(p.includes("youtu.be")){const r=s.pathname.slice(1).split("/")[0];return r?`https://www.youtube.com/embed/${r}`:null}if(p.includes("youtube.com")){const r=s.searchParams.get("v");return r?`https://www.youtube.com/embed/${r}`:null}}if(x==="wistia"){if(p.includes("wistia.net")&&s.pathname.includes("/embed/iframe/")){const r=(f=s.pathname.split("/embed/iframe/")[1])==null?void 0:f.split("?")[0];return r?`https://fast.wistia.net/embed/iframe/${r}`:null}if(p.includes("wistia.com")){const r=s.pathname.match(/\/medias\/([a-zA-Z0-9]+)/),g=r?r[1]:(c=s.pathname.replace(/^\/+/,"").split("/").pop())==null?void 0:c.split("?")[0];return g?`https://fast.wistia.net/embed/iframe/${g}`:null}}}catch{return null}return null}const ae=({videoType:x,videoUrl:h,className:f="",title:c="Video"})=>{const s=re(x,h);return s?e.jsx("div",{className:`relative w-full rounded-xl overflow-hidden bg-black ${f}`,style:{paddingBottom:"56.25%"},children:e.jsx("iframe",{src:s,title:c,className:"absolute inset-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})}):e.jsx("div",{className:`bg-surface/80 border border-border rounded-xl flex items-center justify-center text-muted ${f}`,children:"Invalid video URL"})},fe=()=>{var z,E;const{courseId:x}=q(),h=G(),f=H(),{localizePath:c}=K(),{t:s}=Q(),p=(z=f.state)==null?void 0:z.openLessonId,[r,g]=m.useState(null),[l,I]=m.useState([]),[j,k]=m.useState({}),[O,L]=m.useState(!1),[U,C]=m.useState(!0),[o,b]=m.useState(0),[_,P]=m.useState(!1),u=x?parseInt(x,10):NaN,n=l.length>0&&o>=0&&o<l.length?l[o]:null,S=l.filter(t=>{var a;return(a=j[t.id])==null?void 0:a.completed}).length,$=l.length>0?Math.round(S/l.length*100):0;m.useEffect(()=>{if(!u||isNaN(u)){C(!1);return}(async()=>{C(!0);try{const[a,i,d,N]=await Promise.all([fetch(`${R()}/api/courses/${u}`),fetch(`${R()}/api/courses/${u}/lessons`),w(`/api/courses/${u}/progress`),w("/api/courses/my-courses")]);if(a.ok&&g(await a.json()),i.ok){const y=await i.json();I(y.lessons||[])}if(d.ok){const y=await d.json();k(y.progress||{})}if(N.ok){const V=((await N.json()).courses||[]).map(Z=>Z.id);L(V.includes(u))}}catch{g(null),I([]),k({})}finally{C(!1)}})()},[u]),m.useEffect(()=>{if(l.length!==0)if(p!=null){const t=l.findIndex(a=>a.id===p);t>=0?b(t):b(0)}else{const t=l.findIndex(a=>{var i;return!((i=j[a.id])!=null&&i.completed)});b(t>=0?t:0)}},[l,p,j]);const A=async()=>{P(!0);try{(await w("/api/enrollments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course_id:u})})).ok&&L(!0)}finally{P(!1)}},D=async t=>{await w("/api/progress",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({lesson_id:t.id,completed:!0})}),k(a=>{var i;return{...a,[t.id]:{...a[t.id],completed:!0,watch_time_seconds:((i=a[t.id])==null?void 0:i.watch_time_seconds)??0}}})},J=()=>{o>0&&b(o-1)},M=()=>{o<l.length-1&&b(o+1)};return U?e.jsxs("div",{className:"flex flex-col min-h-screen relative",children:[e.jsx("div",{className:"fixed inset-0 grid-bg pointer-events-none z-0"}),e.jsx("div",{className:"flex-1 relative z-10 pt-20 md:pt-24 px-4 md:px-6 lg:px-8 pb-4 md:pb-6 lg:pb-8 flex items-center justify-center",children:e.jsx("p",{className:"text-muted",children:s("course.loadingCourse")})})]}):r?O?e.jsxs("div",{className:"flex flex-col min-h-screen relative",children:[e.jsx("div",{className:"fixed inset-0 grid-bg pointer-events-none z-0","aria-hidden":!0}),e.jsx("main",{className:"flex-1 relative z-10 pt-20 md:pt-24 px-4 md:px-6 lg:px-8 pb-4 md:pb-6 lg:pb-8",children:e.jsxs("div",{className:"max-w-[1440px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted flex-wrap",children:[e.jsx(T,{to:c("/dashboard/academy"),className:"hover:text-primary transition-colors",children:s("course.academy")}),e.jsx(v,{className:"w-3 h-3 shrink-0"}),e.jsx(T,{to:c("/dashboard/academy"),className:"hover:text-primary transition-colors",children:r.title}),e.jsx(v,{className:"w-3 h-3 shrink-0"}),e.jsx("span",{className:"text-foreground",children:(n==null?void 0:n.title)??"—"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:J,disabled:o===0,className:"px-4 py-2 rounded-btn bg-white/5 border border-white/5 text-muted hover:text-foreground hover:bg-white/10 text-xs font-medium flex items-center gap-2 transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(F,{className:"w-4 h-4"})," ",s("course.previous")]}),e.jsxs("button",{onClick:M,disabled:o===l.length-1,className:"px-4 py-2 rounded-btn bg-primary/10 border border-primary/20 text-primary hover:bg-primary/20 text-xs font-bold flex items-center gap-2 transition-all shadow-glow-primary-sm disabled:opacity-40 disabled:cursor-not-allowed",children:[s("course.nextLesson")," ",e.jsx(v,{className:"w-4 h-4"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel rounded-card p-0 overflow-hidden relative aspect-video",children:[e.jsx(ae,{videoType:n.video_type,videoUrl:n.video_url,title:n.title,className:"rounded-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-start pointer-events-none",children:[e.jsxs("span",{className:"bg-black/60 backdrop-blur-md text-white px-3 py-1 rounded text-xs font-medium border border-white/10",children:[s("course.lesson")," ",o+1]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent pointer-events-none",children:[e.jsx("div",{className:"w-full bg-white/20 h-1.5 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full rounded-full transition-all",style:{width:`${$}%`}})}),e.jsx("div",{className:"flex justify-between items-center text-xs font-medium text-gray-300 mt-2",children:e.jsxs("span",{children:[S," / ",l.length," lessons"]})})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:n.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted mb-4 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4 text-primary"})," ",s("course.lesson")," ",o+1]}),e.jsx("span",{className:"flex items-center gap-1 text-accent",children:"Intermediate"})]}),e.jsx("p",{className:"text-muted leading-relaxed text-sm md:text-base",children:n.description||s("course.noDescription")}),!((E=j[n.id])!=null&&E.completed)&&e.jsxs("button",{onClick:()=>D(n),className:"mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-btn bg-primary text-black font-bold text-sm hover:bg-primary-glow transition-colors",children:[e.jsx(ee,{className:"w-4 h-4"})," ",s("course.markComplete")]})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground mb-4",children:s("course.lessonResources")}),n.resources&&n.resources.length>0?e.jsx("div",{className:"flex flex-col gap-2",children:n.resources.map(t=>e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"glass-panel p-4 rounded-xl flex items-center gap-4 hover:border-primary/30 transition-all group",children:[e.jsx("span",{className:"flex-1 min-w-0 text-sm font-medium text-foreground group-hover:text-primary truncate",children:t.title}),e.jsx(v,{className:"w-4 h-4 text-muted shrink-0"})]},t.id))}):e.jsx("p",{className:"text-sm text-muted",children:s("course.noResources")})]})]}):e.jsx("div",{className:"glass-panel rounded-card p-8 flex items-center justify-center aspect-video",children:e.jsx("p",{className:"text-muted",children:s("course.noLessons")})})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"glass-panel rounded-card flex flex-col lg:sticky lg:top-24 h-[calc(100vh-140px)] min-h-[320px]",children:[e.jsxs("div",{className:"p-5 border-b border-border bg-surface/50 shrink-0",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground mb-1",children:s("course.courseContent")}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted",children:[e.jsxs("span",{children:[l.length," Lessons"]}),e.jsxs("span",{className:"text-primary font-mono",children:[$,"% ",s("course.complete")]})]}),e.jsx("div",{className:"w-full bg-white/5 h-1.5 rounded-full overflow-hidden mt-3",children:e.jsx("div",{className:"bg-gradient-to-r from-accent to-primary h-full rounded-full transition-all duration-500",style:{width:`${$}%`}})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 sidebar-scroll",children:[e.jsx("div",{className:"px-3 py-2",children:e.jsx("h4",{className:"text-xs font-bold text-muted uppercase tracking-wider",children:s("course.lessons")})}),l.map((t,a)=>{var N;const i=((N=j[t.id])==null?void 0:N.completed)??!1,d=o===a;return e.jsxs("button",{type:"button",onClick:()=>b(a),className:`w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors ${d?"bg-primary/10 border border-primary/20 shadow-glow-primary-sm":"hover:bg-white/5 border border-transparent"} ${!d&&!i?"opacity-80":""}`,children:[e.jsx("span",{className:"min-w-6 flex justify-center shrink-0",children:i?e.jsx(se,{className:"w-5 h-5 text-primary"}):d?e.jsx(B,{className:"w-5 h-5 text-primary animate-pulse"}):e.jsx(B,{className:"w-5 h-5 text-muted"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${i&&!d?"text-muted line-through decoration-muted":"text-foreground"}`,children:t.title}),e.jsx("span",{className:`text-[10px] ${d?"text-primary/80 font-mono":"text-muted"}`,children:d?s("course.nowPlaying"):`${s("course.lesson")} ${a+1}`})]})]},t.id)})]})]})})]})]})})]}):e.jsxs("div",{className:"flex flex-col min-h-screen relative",children:[e.jsx("div",{className:"fixed inset-0 grid-bg pointer-events-none z-0"}),e.jsx("div",{className:"flex-1 relative z-10 pt-20 md:pt-24 px-4 md:px-6 lg:px-8 pb-4 md:pb-6 lg:pb-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>h(c("/dashboard")),className:"text-muted hover:text-foreground text-sm mb-6 inline-flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"})," ",s("course.backToDashboard")]}),e.jsxs("div",{className:"rounded-card border border-border bg-surface/80 overflow-hidden shadow-card",children:[e.jsxs("div",{className:"relative aspect-[21/9] bg-surfaceElevated",children:[r.image_url?e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${r.image_url})`}}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(X,{className:"w-20 h-20 text-muted opacity-50"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-surface via-transparent to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground drop-shadow",children:r.title})})]}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsx("p",{className:"text-muted mb-6",children:r.description||"—"}),e.jsxs("button",{onClick:A,disabled:_,className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-primary text-black font-bold hover:bg-primary-glow disabled:opacity-50 transition-colors",children:[s(_?"course.enrolling":"course.enrollInThisCourse"),e.jsx(v,{className:"w-4 h-4"})]})]})]})]})})]}):e.jsxs("div",{className:"flex flex-col min-h-screen relative",children:[e.jsx("div",{className:"fixed inset-0 grid-bg pointer-events-none z-0"}),e.jsxs("div",{className:"flex-1 relative z-10 pt-20 md:pt-24 px-4 md:px-6 lg:px-8 pb-4 md:pb-6 lg:pb-8 flex flex-col items-center justify-center gap-4",children:[e.jsx("p",{className:"text-muted",children:s("course.courseNotFound")}),e.jsx("button",{onClick:()=>h(c("/dashboard")),className:"px-4 py-2 rounded-xl bg-primary text-black font-bold hover:bg-primary-glow",children:s("course.backToDashboard")})]})]})};export{fe as C};
