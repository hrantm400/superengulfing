# Почему письма попадают в спам и что сделать

## 1. Ссылки в письмах (главная причина)

Сейчас в `.env` стоит **API_URL=http://localhost:3001**. В письмах тогда подставляется ссылка вида:
`http://localhost:3001/api/confirm/TOKEN`.

- Для получателя **localhost** — это его компьютер, а не ваш сервер, ссылка не работает.
- Почтовые сервисы (Gmail, Yahoo и др.) считают ссылки на localhost подозрительными и чаще отправляют такие письма в спам.

**Что сделать:** В продакшене в `.env` укажите **публичный адрес вашего API** по HTTPS, например:

```env
API_URL=https://api.superengulfing.com
THANK_YOU_URL=https://superengulfing.com/thank-you
```

(Замените на ваши реальные домены.) После этого ссылки «Confirm» и «Unsubscribe» в письмах будут вести на ваш сайт и не будут выглядеть как спам.

---

## 2. SPF, DKIM, DMARC (аутентификация домена)

Почтовики проверяют, что письмо действительно отправлено с вашего домена. Для этого в DNS домена **superengulfing.com** должны быть записи SPF, DKIM и при желании DMARC.

- **Namecheap Private Email** обычно даёт инструкции по настройке SPF/DKIM в панели почты.
- В разделе домена (Domain List → Manage → Advanced DNS) добавьте записи, которые предлагает Namecheap для Private Email.
- Без корректных SPF/DKIM письма с `@superengulfing.com` чаще уходят в спам.

---

## 3. Что уже сделано в коде

- **Double opt-in** — письмо с подтверждением подписки, затем welcome с PDF.
- **Plain text** — у писем подтверждения и welcome есть текстовая версия (меньше шансов попасть в спам).
- **List-Unsubscribe** — заголовки для кнопки «Отписаться» в Gmail/Yahoo.
- **Reply-To** — указан ответный адрес (при необходимости задайте `SMTP_REPLY_TO` в `.env`).
- В тексте убрано лишнее слово «FREE» в ключевых местах, чтобы не триггерить спам-фильтры.

---

## 4. Краткий чеклист

1. В продакшене в `.env`: **API_URL** и **THANK_YOU_URL** — только публичные HTTPS-адреса, без localhost.
2. Настроить **SPF и DKIM** для домена в панели Namecheap (инструкции у хостинга почты).
3. При необходимости добавить в `.env` **SMTP_REPLY_TO** (например, `info@superengulfing.com`).
4. Первое время отправлять понемногу и следить за жалобами и попаданием в спам — репутация отправителя влияет на доставляемость.
